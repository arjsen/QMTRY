<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Math MCQ – Wizard</title>

<!-- small CSS reset for consistency -->
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/modern-normalize/modern-normalize.min.css">

<style>
:root { --accent:#0e639c; --bar:#4caf50; }

body      { margin:0; font-family:system-ui,Arial,sans-serif; color:#222; }
/* ---------- header / progress ---------- */
header    { padding:1rem 1rem .5rem; display:flex; flex-wrap:wrap; gap:.7rem;
            align-items:center; border-bottom:1px solid #ddd; }
header h1 { font-size:1.2rem; color:var(--accent); margin:0; }
#progress { width:100%; height:6px; background:#eee; border-radius:3px; overflow:hidden;
            position:relative; flex:1 1 100%; margin-top:.4rem; }
#progress::after{ content:''; position:absolute; inset:0; width:var(--pct,0);
                  background:var(--bar); transition:width .3s; }

/* ---------- main pane ---------- */
main      { max-width:720px; margin:0 auto; padding:1.5rem 1rem; min-height:60vh;
            display:flex; flex-direction:column; gap:1.25rem; }
fieldset  { border:1px solid #ddd; border-radius:12px; padding:1rem 1.25rem; }
legend    { font-weight:600; }
.choice   { display:block; margin:.5rem 0; cursor:pointer; }
.muted    { color:#666; font-size:.9rem; margin-top:.5rem; }
/* ---------- result colouring ---------- */
.correct  { border-color:#4caf50; background:#f1fbf1; }
.incorrect{ border-color:#f44336; background:#fff4f4; }
.answer-tag{font-size:.85rem; margin-left:.40rem;}
/* ---------- footer / nav buttons ---------- */
footer    { padding:1rem; display:flex; justify-content:space-between; gap:.75rem; }
.btn      { flex:1 1 120px; padding:.55rem 1.2rem; font-size:1rem; border:1px solid var(--accent);
            background:var(--accent); color:#fff; border-radius:6px; cursor:pointer; }
.btn[disabled]{opacity:.4; cursor:default;}
/* ---------- feedback banner ---------- */
.feedback { font-weight:600; margin-top:1rem; text-align:center; }
.bad      { color:#d32f2f } .warn{color:#f57c00} .ok{color:#1976d2}
.good     { color:#2e7d32 } .excellent{ color:#2e7d32; font-weight:700 }
</style>

<!-- MathJax (for \( … \) inline math) -->
<script>
window.MathJax = { tex: { inlineMath:[['\\(','\\)']], displayMath:[['\\[','\\]']] } };
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

<header>
  <a href="index.html">← All tests</a>
  <h1>Math MCQ</h1>
  <div id="progress"></div>
</header>

<main id="stepPane"></main>

<footer>
  <button id="prevBtn" class="btn" disabled>‹ Back</button>
  <button id="nextBtn" class="btn" disabled>Next ›</button>
</footer>

<script>
/* ===== helpers (shuffle, normalise) ===== */
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} }
function normalise(q,i){
  const id=q.id||`q${i+1}`;
  let choices=[];
  if(Array.isArray(q.choices) && typeof q.choices[0]==='string'){
    choices=q.choices.map((t,idx)=>({text:t,correct:idx===q.answer}));
  }else if(Array.isArray(q.choices)){
    choices=q.choices.map(c=>({text:c.text,correct:!!c.correct}));
  }
  return {id,question:q.question||'',choices,explanation:q.explanation||''};
}

/* ===== comment buckets ===== */
const COMMENTS={
  lt50:["You need to revise and practice more!"],
  lt70:["You can improve by revising more!"],
  lt80:["Good work!"],
  lt90:["Great job—you're close to excellence!"],
  ge90:["Excellent work!"]
};
const pick=a=>a[Math.floor(Math.random()*a.length)];

/* ===== DOM refs ===== */
const stepPane=document.getElementById('stepPane'),
      progress=document.getElementById('progress'),
      prevBtn=document.getElementById('prevBtn'),
      nextBtn=document.getElementById('nextBtn');

/* ===== state ===== */
let questions=[], answers=[], idx=0;

/* ===== render one question ===== */
function render(idx){
  const q=questions[idx];
  stepPane.innerHTML='';
  const fs=document.createElement('fieldset');
  fs.innerHTML=`<legend>Q${idx+1}. ${q.question}</legend>`;
  q.choices.forEach((c,ci)=>{
    const lbl=document.createElement('label'); lbl.className='choice';
    lbl.innerHTML=`<input type="radio" name="c" value="${ci}"><span> ${c.text}</span>`;
    if(answers[idx]===ci) lbl.querySelector('input').checked=true;
    fs.appendChild(lbl);
  });
  stepPane.appendChild(fs);
  MathJax.typesetPromise();

  /* update bar & buttons */
  progress.style.setProperty('--pct', (idx/questions.length*100)+'%');
  prevBtn.disabled = idx===0;
  nextBtn.textContent = idx===questions.length-1 ? 'Submit' : 'Next ›';
  nextBtn.disabled = false;
}

/* ===== grade all ===== */
function grade(){
  let score=0,total=questions.length;
  stepPane.innerHTML='';
  questions.forEach((q,i)=>{
    const correctIdx=q.choices.findIndex(c=>c.correct);
    if(answers[i]===correctIdx) score++;
  });
  const pct=Math.round(score/total*100);
  let band='ok'; if(pct<50)band='bad'; else if(pct<70)band='warn'; else if(pct<80)band='ok';
  else if(pct<90)band='good'; else band='excellent';

  const fb=document.createElement('p');
  fb.className=`feedback ${band}`;
  fb.textContent=`Score ${score}/${total} — ${pct}% — ${pick(
    band==='bad'?COMMENTS.lt50:
    band==='warn'?COMMENTS.lt70:
    band==='ok'?COMMENTS.lt80:
    band==='good'?COMMENTS.lt90:COMMENTS.ge90
  )}`;
  stepPane.appendChild(fb);

  progress.style.setProperty('--pct','100%');
  prevBtn.disabled=true; nextBtn.disabled=true;
}

/* ===== nav button handlers ===== */
prevBtn.onclick=function(){
  if(idx>0){ idx--; render(idx); }
};
nextBtn.onclick=function(){
  const sel=document.querySelector('input[name="c"]:checked');
  if(!sel){ alert('Please select an answer'); return; }
  answers[idx]=Number(sel.value);

  if(idx < questions.length-1){
    idx++; render(idx);
  }else{
    grade();
  }
};

/* ===== auto-load quiz from ?test=slug ===== */
(async function(){
  const slug=new URLSearchParams(location.search).get('test');
  if(!slug){ stepPane.textContent='Missing “test=…” parameter.'; return; }
  try{
    const res=await fetch(`tests/${slug}.json`);
    if(!res.ok) throw new Error('Could not load tests/'+slug+'.json');
    questions=(await res.json()).map(normalise);
    shuffle(questions);              /* remove if you don’t want random order */
    answers=new Array(questions.length).fill(null);
    render(0);
  }catch(err){
    stepPane.textContent=err.message;
  }
})();
</script>
</body>
</html>
